<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Hakyll Blog - Refaire le switch expression de java</title>
    <link rel="stylesheet" href="../css/default.css" />
    <link rel="stylesheet" href="../css/syntax.css" />
    <meta charset="UTF-8" />
  </head>
  <body>
    <header>
      <div class="logo">
        <a href="../">Baudet blanc et blanc baudet</a>
      </div>
      <nav>
        <a href="../">Accueil</a>
        <a href="../about.html">À propos</a>
        <a href="../contact.html">Contact</a>
        <a href="../archive.html">Archives</a>
      </nav>
    </header>

    <main role="main">
      <h1>Refaire le switch expression de java</h1>
      <article>
    <section class="header">
        Posted on February 22, 2022
        
    </section>
    <section>
        <p>Il y a quelques années maintenant je suis tombé sur un article proposant d’implémenter en java 8 les switch expression sorti en java 12 à l’aide d’expressions lambda. j’avais bien aimé sa lecture et la mise en avant de certains concepts, néanmoins j’étais déçu par plusieurs points du code final, en particulier:</p>
<ul>
<li>Les cases n’étaient pas vraiment exécutées dans l’odre de leur décralation.</li>
<li>Il n’était pas vraiment possible d’étendre les cases présents</li>
</ul>
<p>Pour ces deux raisons, j’ai décidé de tenter moi aussi la réécriture du switch à ma manière, et de voir ce que je peux apprendre en chemin.</p>
<h2 id="premier-jet">Premier jet</h2>
<p>En décortiquant la structure switch, je note trois parties:</p>
<ul>
<li>La valeur à match</li>
<li>Un ensemble de cas, chacun lié à une valeur retournée</li>
<li>Un cas <code>default</code>, qui renvois sa valeur si rien ne correspond avant.</li>
</ul>
<p>Pour cete raison, il me semble important de commencer mon code par lype d’un cas, représenté par un test de correspondace et la valeur à renvoyer si le retst passe.</p>
<p>Pour ce faire, je décide de crée une interface :</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Rule<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">test</span><span class="op">(</span>V value<span class="op">);</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> R <span class="fu">run</span><span class="op">();</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Une méthode pour le tester le cas et une pour le retour. Comme je ne sais pas à l’avance les types de la valeur à tester ou de celle retournée, j’ai donc besoin de deux génériques, <code>Value</code>, et <code>Return</code>.</p>
<p>À partir de ça je peux alors définir la classe implémentant mon switch:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Switcher<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">ArrayList</span><span class="op">&lt;</span>Rule<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;&gt;</span> rules<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> V value<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> R def<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Switcher</span><span class="op">(</span>V value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">rules</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">def</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Où j’ai donc ma collection des règles, la valeur à tester et la valeur de retour par défaut (Si non founie, je renvois null par défaut). Je retrouve aussi les génériques utilisés dans mon interface.</p>
<p>Je peux ensuite ajouter trois méthodes pour m’en servir:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Switcher<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> <span class="fu">addRule</span><span class="op">(</span>Rule<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> rule<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    rules<span class="op">.</span><span class="fu">add</span><span class="op">(</span>rule<span class="op">);</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> Switcher<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> <span class="fu">defaults</span><span class="op">(</span>R def<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">def</span> <span class="op">=</span> def<span class="op">;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> R <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>Rule<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> rule <span class="op">:</span> rules<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>rule<span class="op">.</span><span class="fu">test</span><span class="op">(</span>value<span class="op">))</span> <span class="op">{</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> rule<span class="op">.</span><span class="fu">run</span><span class="op">();</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">def</span><span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Rien d’extraordinaire ici, deux méthodes pour ajouter des règles et définir le default, puis une méthode pour exécuter le tout: je parcours les règles et je renvois le retour de la première valide. Ou je renvois <code>this.def</code> si je n’en trouve pas.</p>
<p>Avec ce code, je suis déjà en mesure de produire un exemple de switch:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> age <span class="op">=</span> <span class="dv">18</span><span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> reponse <span class="op">=</span> <span class="kw">new</span> Switcher<span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;(</span>age<span class="op">)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">defaults</span><span class="op">(</span><span class="st">&quot;impossible !&quot;</span><span class="op">)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">addRule</span><span class="op">(</span><span class="kw">new</span> Rule<span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">test</span><span class="op">(</span><span class="bu">Integer</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> value <span class="op">==</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="bu">String</span> <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;le meilleur age !&quot;</span><span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">addRule</span><span class="op">(</span><span class="kw">new</span> Rule<span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">test</span><span class="op">(</span><span class="bu">Integer</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> value <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> value <span class="op">&lt;</span> <span class="dv">18</span><span class="op">;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="bu">String</span> <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;en voilà un enfant !&quot;</span><span class="op">;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">addRule</span><span class="op">(</span><span class="kw">new</span> Rule<span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">test</span><span class="op">(</span><span class="bu">Integer</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> value <span class="op">&lt;</span> <span class="dv">70</span><span class="op">;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="bu">String</span> <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;bande de jeunes decadents !&quot;</span><span class="op">;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">run</span><span class="op">();</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>reponse<span class="op">);</span></span></code></pre></div>
<p>Le code fait usage des classes anonymes pour chaque cas, et ça marche très bien. Un avantage est qu’on peut définir chaque cas sans avoir à recréer une classe dédiée, ce qui serait nécessaire ici puisque chaque implémentation de test est différente d’un cas à l’autre. Néanmoins, c’est assez… verbeux.</p>
<h2 id="un-peu-de-spécialisation">Un peu de spécialisation</h2>
<p>Heureusement, il existe des solutions à cela et une première c’est l’héritage.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">abstract</span> <span class="kw">class</span> EqualityRule<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> <span class="kw">implements</span> Rule<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> V tester<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">EqualityRule</span><span class="op">(</span>V tester<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">tester</span> <span class="op">=</span> tester<span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">test</span><span class="op">(</span>V value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> value<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>tester<span class="op">);</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>En faisant ainsi, je crée une règle donc le test est spécialisé et je n’ai plus qu’à spécifier le retour, ce qui alège partiellement mon code (ouf !):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// avant</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">addRule</span><span class="op">(</span><span class="kw">new</span> Rule<span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">test</span><span class="op">(</span><span class="bu">Integer</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> value <span class="op">==</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;le meilleur age !&quot;</span><span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">// apres</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">addRule</span><span class="op">(</span><span class="kw">new</span> EqualityRule<span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;(</span><span class="dv">42</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;le meilleur age !&quot;</span><span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span></code></pre></div>
<p>En faisant ainsi je pourrait créer autant de règles de la nature souhaitée en spécialisant à volonté. Par exemple, je peux faire une règle qui n’exécute pas de code avant de retourner. Petit hic cependant, java n’autorisant pas l’héritage multiple, il ne m’est pas possible d’hériter de plusieurs règles pour les composer entre elles (outch !).</p>
<p>Autre possibilité, le <code>factory</code>: plutôt que de créer une classe pour chaque cas, je vais créer une fonction qui retournera ma clase anonyme. Par exemple, si je reprend le code au dessus:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// definitions</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Lambda<span class="op">&lt;</span>I<span class="op">,</span> O<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> O <span class="fu">call</span><span class="op">(</span>I value<span class="op">);</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="kw">class</span> RuleFactory <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> Rule<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> <span class="fu">equalRule</span><span class="op">(</span>V v<span class="op">,</span> Lambda<span class="op">&lt;</span><span class="bu">Void</span><span class="op">,</span> R<span class="op">&gt;</span> run<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> Rule<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;()</span> <span class="op">{</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">test</span><span class="op">(</span>V value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> value<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>v<span class="op">);</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> R <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> run<span class="op">.</span><span class="fu">call</span><span class="op">(</span><span class="kw">null</span><span class="op">);</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="fu">RuleFactory</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">// utilisation</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">addRule</span><span class="op">(</span>RuleFactory<span class="op">.</span><span class="fu">equalRule</span><span class="op">(</span><span class="dv">42</span><span class="op">,</span> <span class="op">(</span>v<span class="op">)</span> <span class="op">-&gt;</span> <span class="st">&quot;le meilleur age !&quot;</span><span class="op">))</span></span></code></pre></div>
<p>Plutôt court, n’est-ce pas ?</p>
<h2 id="uber-généralisation">Uber-généralisation</h2>
<p>Pour concluse cet article, je vais aborder un dernier point sur ce switch qui concerne un problème de spécialisation des règles: le fait de définir deux comportements en même temps. Parce que le switch est très souple dans son traitement il est assez compliqué de vraiment prévoir tous les cas possibles et souhaitables. Le dernier exemple de code ajoute d’ailleurs la définition d’une interface pour décrire les expression lambdas à passer en paramètre, qui me permet de définir le comportement de retour de façon plus concise. C’est pourquoi je vais apporter une dernière solutuion en passant deux lambdas en paramètres.</p>
<p>D’abord, je peux étendre ma interface avec une classe concrète:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GeneralRule<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> <span class="kw">implements</span> Rule<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Lambda<span class="op">&lt;</span>V<span class="op">,</span> <span class="bu">Boolean</span><span class="op">&gt;</span> tester<span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Lambda<span class="op">&lt;</span><span class="bu">Void</span><span class="op">,</span> R<span class="op">&gt;</span> runner<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">GeneralRule</span><span class="op">(</span>Lambda<span class="op">&lt;</span>V<span class="op">,</span> <span class="bu">Boolean</span><span class="op">&gt;</span> tester<span class="op">,</span> Lambda<span class="op">&lt;</span><span class="bu">Void</span><span class="op">,</span> R<span class="op">&gt;</span> runner<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">tester</span> <span class="op">=</span> tester<span class="op">;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">runner</span> <span class="op">=</span> runner<span class="op">;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">test</span><span class="op">(</span>V value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> tester<span class="op">.</span><span class="fu">call</span><span class="op">(</span>value<span class="op">);</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> R <span class="fu">run</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> runner<span class="op">.</span><span class="fu">call</span><span class="op">(</span><span class="kw">null</span><span class="op">);</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">// plus un constructeur dans mon switch</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Switcher<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Switcher<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;</span> <span class="fu">addGeneralRule</span><span class="op">(</span>Lambda<span class="op">&lt;</span>V<span class="op">,</span> <span class="bu">Boolean</span><span class="op">&gt;</span> tester<span class="op">,</span> Lambda<span class="op">&lt;</span><span class="bu">Void</span><span class="op">,</span> R<span class="op">&gt;</span> runner<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        rules<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="kw">new</span> GeneralRule<span class="op">&lt;</span>V<span class="op">,</span> R<span class="op">&gt;(</span>tester<span class="op">,</span> runner<span class="op">));</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Faisant ainsi, je peux alors faire des constructeurs sur chaque comportement individuellement pour ensuite le fournir à <code>RuleFactory.generalRule</code>, ça me permet alors de gagner une souplesse que je n’avais pas forcément avant.</p>
<p>Cet articles est bien trop grand par rapport à ce que je voulais faire alors je vais conclure avec un dernier exemple de code avant de vouloir tout effacer pour repartir de 0. Le code complet (mal rangé) est disponible <a href="https://github.com/HellperKK/HellperKK.github.io/blob/master/code/switch/Main.java">sur le repo du blog</a>.</p>
<p>À plush !</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// des constructeur de lambdas</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="kw">class</span> LambdaBuilder <span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span>V<span class="op">&gt;</span> Lambda<span class="op">&lt;</span>V<span class="op">,</span> <span class="bu">Boolean</span><span class="op">&gt;</span> <span class="fu">equalTest</span><span class="op">(</span>V v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">(</span>V value<span class="op">)</span> <span class="op">-&gt;</span> value<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>v<span class="op">);</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span>V <span class="kw">extends</span> <span class="bu">Comparable</span><span class="op">&lt;</span>V<span class="op">&gt;&gt;</span> Lambda<span class="op">&lt;</span>V<span class="op">,</span> <span class="bu">Boolean</span><span class="op">&gt;</span> <span class="fu">rangeTest</span><span class="op">(</span>V min<span class="op">,</span> V max<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">(</span>V value<span class="op">)</span> <span class="op">-&gt;</span> value<span class="op">.</span><span class="fu">compareTo</span><span class="op">(</span>min<span class="op">)</span> <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> value<span class="op">.</span><span class="fu">compareTo</span><span class="op">(</span>max<span class="op">)</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span>R<span class="op">&gt;</span> Lambda<span class="op">&lt;</span><span class="bu">Void</span><span class="op">,</span> R<span class="op">&gt;</span> <span class="fu">valueRunner</span><span class="op">(</span>R result<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">(</span><span class="bu">Void</span> v<span class="op">)</span> <span class="op">-&gt;</span> result<span class="op">;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="fu">LambdaBuilder</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">// je reprend le premier exemple</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> age <span class="op">=</span> <span class="dv">18</span><span class="op">;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> reponse <span class="op">=</span> <span class="kw">new</span> Switcher<span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">String</span><span class="op">&gt;(</span>age<span class="op">)</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">defaults</span><span class="op">(</span><span class="st">&quot;impossible !&quot;</span><span class="op">)</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">addGeneralRule</span><span class="op">(</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        LambdaBuilder<span class="op">.</span><span class="fu">equalTest</span><span class="op">(</span><span class="dv">42</span><span class="op">),</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        LambdaBuilder<span class="op">.</span><span class="fu">valueRunner</span><span class="op">(</span><span class="st">&quot;le meilleur age !&quot;</span><span class="op">))</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">addGeneralRule</span><span class="op">(</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        LambdaBuilder<span class="op">.</span><span class="fu">rangeTest</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">18</span><span class="op">),</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        LambdaBuilder<span class="op">.</span><span class="fu">valueRunner</span><span class="op">(</span><span class="st">&quot;en voilà un enfant !&quot;</span><span class="op">))</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">addGeneralRule</span><span class="op">(</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        value <span class="op">-&gt;</span> value <span class="op">&lt;</span> <span class="dv">70</span><span class="op">,</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        LambdaBuilder<span class="op">.</span><span class="fu">valueRunner</span><span class="op">(</span><span class="st">&quot;bande de jeunes decadents !&quot;</span><span class="op">))</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">run</span><span class="op">();</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>reponse<span class="op">);</span></span></code></pre></div>
    </section>
</article>

    </main>

    <footer>
      Site proudly generated by
      <a href="http://jaspervdj.be/hakyll">Hakyll</a>
    </footer>
  </body>
</html>
